---
title: react-navigationå®ç°åŠ¨æ€åº•éƒ¨èœå•
date: 2019-04-13
tags:
  - js
  - react
  - react-native
categories:
  - ç¬”è®°
---

> RN é¡¹ç›®ä¸­ä½¿ç”¨ react-navigation å®ç°åŠ¨æ€åº•éƒ¨èœå•ï¼Œç”¨äºé™åˆ¶ä¸åŒç”¨æˆ·çš„æƒé™

<!-- more -->

## éœ€æ±‚

è¿™æ˜¯å»å¹´ App é¡¹ç›®æå‡ºçš„ä¸€ä¸ªéœ€æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬åšçš„è¿™ä¸ª App åŒºåˆ†äº†å¾ˆå¤šæ¸ é“ï¼ŒåŒæ—¶ç™»å½•ç”¨æˆ·ä¹Ÿæœ‰å¾ˆå¤šçŠ¶æ€ï¼Œä¸€äº›èœå•éœ€è¦åŠ¨æ€çš„æ˜¾ç¤ºéšè—ã€‚é¡¹ç›®æ˜¯ä½¿ç”¨çš„ React-Native æ¡†æ¶ï¼Œè·¯ç”±åº“é€‰æ‹©å®˜æ–¹æ¨èçš„ react-navigationï¼Œæ‰€ä»¥è¦å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œå¿…é¡»æ˜¯æ”¹åŠ¨ react-navigation çš„é…ç½®ã€‚ä½†æ˜¯ react-navigation çš„æ–‡æ¡£éå¸¸æ‰¯æ·¡ï¼Œreact-navigation çš„æ–‡æ¡£æ˜¯è¿™æ ·å†™çš„ï¼š

> ä½¿ç”¨åŠ¨æ€è·¯ç”±ï¼Œéœ€è¦å¯¹ React-Navigation æœ‰ä¸€ç‚¹äº†è§£æ‰èƒ½å……åˆ†å‘æŒ¥ã€‚React-Navigation è¦æ±‚ä½ é™æ€çš„å®šä¹‰ä½ çš„è·¯ç”±ï¼Œå¦‚æœä½ ä¸€å®šè¦ä½¿ç”¨åŠ¨æ€è·¯ç”±ï¼Œä¹Ÿæœ‰è§£å†³æ–¹æ¡ˆï¼Œä½†å¯èƒ½ä¼šæœ‰ä¸€äº›é¢å¤–çš„å¤æ‚åº¦ã€‚

what?ä½ ä»¥ä¸ºä¼šæœ‰åç»­å‘Šè¯‰æˆ‘ä»¬è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆå—ï¼Œæ–‡æ¡£å†™åˆ°è¿™å°±æ²¡äº†ï¼Œè¿™ä¸æ˜¯è„±äº†è£¤å­æ”¾å±å—ï¼Œæ—¢ç„¶è¯´äº†æœ‰è§£å†³æ–¹æ¡ˆï¼Œåˆä¸ç»™æˆ‘è¯´å…·ä½“è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆã€‚å¼•ç”¨ç½—è€å¸ˆçš„åè¨€ï¼š<u>æˆ‘æ€€ç–‘ä½ åœ¨å¤–é¢æœ‰å…­ä¸ªç§ç”Ÿå­ï¼Œä½†æˆ‘ä¸èƒ½å‘Šè¯‰ä½ æ˜¯è° ğŸ˜</u>

![laoluo](../assets/laoluo.gif)

## å¥½å‡ ä¸ªä¸åŒçš„è§£å†³æ–¹æ¡ˆ

æœ€ç»ˆå®Œç¾è§£å†³è¿™ä¸ªéœ€æ±‚ç»å†äº† 3 æ¬¡æ–¹æ¡ˆæ›´æ”¹ï¼š

1. ç¬¬ä¸€æ¬¡çš„æ–¹æ¡ˆï¼šç›´æ¥åœ¨æ ¹çº§ç»„ä»¶å¤„å®šä¹‰ä¸€ä¸ªçŠ¶æ€ï¼Œæ ¹æ®åç«¯è¿”å›çš„çŠ¶æ€ä¸åŒç”Ÿæˆä¸åŒçš„ react-navigation é…ç½®ã€‚è¿™ç§æ–¹æ¡ˆè™½å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½ä¸Šæœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œå› ä¸º react-navigation æ˜¯æƒ°æ€§åŠ è½½é¡µé¢ç»„ä»¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å¯¼èˆªåˆ°äº†è¿™ä¸ªé¡µé¢æ‰ä¼šæ¸²æŸ“è¯¥é¡µé¢ç»„ä»¶ï¼Œå¹¶ä¸”åªè¦æ­¤é¡µé¢æœªè¢«ç§»é™¤ react-navigation çš„è·¯ç”±æ ˆï¼Œåç»­å†å¯¼èˆªåˆ°æ­¤é¡µé¢æ˜¯ä¸ä¼šç»å†é‡æ–°æ„å»ºé¡µé¢ç»„ä»¶çš„æµç¨‹çš„ã€‚åœ¨æ ¹çº§ç»„ä»¶å¤„æ ¹æ® state æ¥é‡æ–°æ¸²æŸ“ä¼šè®©æ•´ä¸ªæ ¹ç»„ä»¶é‡æ–° renderï¼Œå¹¶ä¸”å› ä¸ºç›´æ¥äº§ç”Ÿæ–°çš„ react-navigation æ ¹å¯¼èˆªç»„ä»¶ï¼Œåœ¨ç”¨æˆ·è§†è§‰ä¸Šä¼šæœ‰ä¸€ä¸ªé¡µé¢é—ªçƒçš„æ„Ÿè§‰ï¼Œå¯¹äºç”¨æˆ·ä½“éªŒæ¥è¯´æ˜¯ä¸å‹å¥½çš„ã€‚
2. ç¬¬äºŒæ¬¡æ–¹æ¡ˆï¼Œå°†åº•éƒ¨èœå•ä½œä¸ºå•ç‹¬çš„å¯¼èˆªç³»ç»Ÿæ¥ä½¿ç”¨ï¼Œè™½ç„¶ react-navigation è¦æ±‚é¡¹ç›®ä¸­åªèƒ½ä½¿ç”¨ä¸€ä¸ªå¯¼èˆªç³»ç»Ÿï¼Œä½†æ˜¯å®é™…è¿™æ ·ç”¨å¹¶ä¸ä¼šæŠ¥é”™ï¼Œåªä¸è¿‡ä¼šåœ¨ ios ç³»ç»Ÿä¸Šæœ‰è­¦å‘Šã€‚è¿™ç§å®ç°åŠ¨æ€åº•éƒ¨èœå•çš„å¥½å¤„å°±æ˜¯ä¸ä¼šæœ‰é—ªçƒï¼Œå¹¶ä¸”ä¹Ÿåªä¼šé‡æ¸²æŸ“è¿™ä¸ªå•ç‹¬çš„åº•éƒ¨å¯¼èˆªç»„ä»¶ï¼Œä¸ä¼šæ•´ä¸ªæ ¹ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚ç¼ºç‚¹æ˜¯ä½¿ç”¨äº†ä¸¤å¥—å¯¼èˆªç³»ç»Ÿï¼Œåœ¨åº•éƒ¨èœå•è¿™ä¸ªç»„ä»¶ä¸Šçš„å¯¼èˆªä¸æ•´ä¸ª App é¡µé¢çš„å¯¼èˆªä½¿ç”¨çš„æ˜¯ä¸åŒçš„ navigationï¼Œéœ€è¦åœ¨ä¸åŒçš„é¡µé¢ä½¿ç”¨ä¸åŒçš„å¯¼èˆªæ–¹å¼ï¼Œå¹¶ä¸”æ— æ³•åœ¨å…¶ä»–é¡µé¢ç›´æ¥å¯¼èˆªåˆ°åº•éƒ¨èœå•ä¸­çš„æŸä¸€ä¸ªå­èœå•ã€‚
3. ç¬¬ä¸‰æ¬¡æ–¹æ¡ˆï¼Œè¿™åº”è¯¥æ˜¯ç›®å‰æœ€å®Œç¾çš„æ–¹æ¡ˆäº†ï¼Œåªä½¿ç”¨ä¸€å¥—å¯¼èˆªç³»ç»Ÿï¼Œè€Œä¸”åŠ¨æ€æ”¹å˜èœå•åªéœ€è¦åˆ·æ–°åº•éƒ¨å¯¼èˆªæ ã€‚

## ä»£ç éƒ¨åˆ†

### æ–¹æ¡ˆä¸€ï¼šæ ¹ç»„ä»¶æ§åˆ¶å¯¼èˆªèœå•

```js
//å…ˆå®šä¹‰ä¸¤ä¸ªä¸åŒçš„åº•éƒ¨ç»„ä»¶ï¼Œæ ¹æ®ç”¨æˆ·æƒé™å†³å®šä½¿ç”¨å“ªä¸ª
//ä¸‰ä¸ªèœå•ï¼š é¦–é¡µï¼Œä¸ªäººä¸­å¿ƒï¼Œå’Œå•†å“æ¨èé¡µé¢ï¼Œæ ¹æ®ç”¨æˆ·æƒé™å†³å®šæ˜¯å¦æ˜¾ç¤ºå•†å“æ¨èé¡µé¢
// App.js
const tabbarRoutes = {
  é¦–é¡µ: Home,
  å•†å“æ¨è: LoanMarket,
  ä¸ªäººä¸­å¿ƒ: MyInfo
};

const anotherRoutes = {
  é¦–é¡µ: Home,
  ä¸ªäººä¸­å¿ƒ: MyInfo
};

const MyTabRouter = createBottomTabNavigator(tabbarRoutes);

export default class App extends Component {
  state = {
    showMarket: false
  };

  componentDidMount = () => {
    // è¿™é‡Œç›‘å¬ä¸€ä¸ªäº‹ä»¶ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºå•†å“æ¨èé¡µé¢ï¼Œåˆ™å°†showMarketç½®ä¸ºtrue
    this.subscribe = DeviceEventEmitter.addListener("showMarket", () => {
      this.setState({
        showMarket: true
      });
    });
  };

  componentWillUnmount = () => {
    this.subscribe && this.subscribe.remove();
  };

  render() {
    const tabRoutes = this.state.showMarket ? tabbarRoutes : anotherRoutes;
    const MyTabRouter = createBottomTabNavigator(tabRoutes);
    // ä¸€ä¸ªç³»ç»Ÿä¸€èˆ¬ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªé¡µé¢ï¼Œè¿™é‡Œç®€ä¾¿åªå®šä¹‰ä¸€ä¸ªè·¯ç”±
    const AppStack = createStackNavigator({
      tabbar: {
        screen: MyTabRouter,
        navigationOptions: {
          header: null
        }
      }
    });
    return <AppStack />;
  }
}
```

### æ–¹æ¡ˆäºŒï¼šç‹¬ç«‹çš„åº•éƒ¨å¯¼èˆªç³»ç»Ÿ

```js
// App.js
import TabbarScreen from './tabbar';
import LoginScreen from './login';

const AppStack = createStackNavigator({
  login: {
    screen: LoginScreen,
    navigationOptions: {
      header: 'ç™»å½•'
    }
  }
  tabbar: {
    screen: TabbarScreen,
    navigationOptions: {
      header: null
    }
  }
});

export default class App extends Component {
  render() {
    return <AppStack />;
  }
}

//tabbar.js
const routes = {
  é¦–é¡µ: Home,
  å•†å“æ¨è: LoanMarket,
  ä¸ªäººä¸­å¿ƒ: MyInfo
};

const anotherRoutes = {
  é¦–é¡µ: Home,
  ä¸ªäººä¸­å¿ƒ: MyInfo
};

export default class Tabbar extends Component {
  state = {
    showMarket: false
  }

  componentDidMount = () => {
    // è¿™é‡Œç›‘å¬ä¸€ä¸ªäº‹ä»¶ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºå•†å“æ¨èé¡µé¢ï¼Œåˆ™å°†showMarketç½®ä¸ºtrue
    this.subscribe = DeviceEventEmitter.addListener('showMarket', () => {
      this.setState({
        showMarket: true
      });
    });
  };

  componentWillUnmount = () => {
    this.subscribe && this.subscribe.remove();
  };

  render() {
    const tabRoutes = this.showMarket ? routes : anotherRoutes
    return React.createElement(createBottomTabNavigator(tabRoutes));
  }

}

// æ³¨æ„ï¼šä½¿ç”¨è¿™ç§æ–¹æ¡ˆçš„æ—¶å€™ï¼Œtabbaré¡µé¢å…¶å®æ˜¯ä¸Appå¯¼èˆªç³»ç»Ÿç‹¬ç«‹çš„ä¸€ä¸ªå¯¼èˆªç³»ç»Ÿï¼Œä»¥ä¸‹ä¸¾ä¾‹
//æˆ‘ç°åœ¨å¤„äºLoginé¡µé¢ï¼Œæƒ³è·³è½¬åˆ°tabbaré¡µé¢ï¼š
this.props.navigation.navigate('tabbar'); //æˆåŠŸè·³è½¬
// æˆ‘ç°åœ¨å¤„äºtabbarä¸­Homeé¡µé¢ï¼Œæˆ‘ç°åœ¨æƒ³è·³è½¬Loginï¼š
this.props.navigation.navigate('login'); //ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœï¼Œå› ä¸ºè¿™ä¸ªnavigationåªæ˜¯tabbarä¸­çš„navigationï¼Œä¸èƒ½å¯¼èˆªåˆ°tabbarè·¯ç”±ä»¥å¤–çš„é¡µé¢ã€‚
// æˆ‘ç°åœ¨å¤„äºLoginé¡µé¢ï¼Œæƒ³è·³è½¬åˆ°tabbarä¸­çš„ä¸ªäººä¸­å¿ƒï¼ˆMyInfo)
this.prop.navigation.navigate('ä¸ªäººä¸­å¿ƒ'); //æ— æ•ˆï¼Œå› ä¸ºé¡¶å±‚å¯¼èˆªä¸­æ ¹æœ¬æ²¡æœ‰è¿™æ¡å¯¼èˆªè·¯çº¿

/*è§£å†³tabbarä¸­é¡µé¢è·³è½¬å…¶ä»–é¡µé¢çš„é—®é¢˜ï¼š
ä½¿ç”¨é¡¶å±‚å¯¼èˆªï¼Œå³åœ¨App.jsä¸­è®¾ç½®é¡¶å±‚å¯¼èˆªä¸ºAppStackçš„navigationï¼Œåœ¨tabbarä¸­æƒ³è·³è½¬tabbarä¹‹å¤–çš„é¡µé¢å°±ä½¿ç”¨å¯¼å‡ºçš„é¡¶å±‚å¯¼èˆªè¿›è¡Œè·³è½¬ã€‚
*/

//ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæƒ³åœ¨å…¶ä»–é¡µé¢ç›´æ¥è·³è½¬åˆ°tabbarä¸­æŸä¸ªé¡µé¢ï¼Œè¿™ç§æ–¹æ¡ˆä¸‹æ— æ³•è§£å†³
```

### æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰åº•éƒ¨å¯¼èˆªæ 

è¿™ä¸ªæ–¹æ¡ˆæ˜¯æˆ‘çœ‹è¿‡ react-navigation ä¸­ createBottomTabNavigator ä¸­çš„éƒ¨åˆ†æºç æ‰æƒ³åˆ°çš„ä¸€ä¸ªæ–¹æ¡ˆ,createBottomTabNavigator æ”¯æŒä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„ tabBarComponentï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾è¿™ä¸ªä¸œè¥¿ï¼š

![bottomTabBar](../assets/bottomTabBar.jpg)

ä½†æ˜¯å¦‚æœçœŸè¦å®Œå…¨è‡ªå·±å†™ä¸ªè¿™ä¸œè¥¿æ„Ÿè§‰ä¸ç°å®å•Šï¼Œæ¯•ç«Ÿæ¶‰åŠåˆ°ä¸åŒæœºå‹åˆ†è¾¨ç‡çš„é€‚é…å¤„ç†ï¼Œä»¥åŠè·¯ç”±è·³è½¬çš„é€»è¾‘ã€‚ä½†æˆ‘è¿˜æ˜¯å»çœ‹äº† createBottomTabNavigator çš„æºç ï¼Œæˆ‘çœ‹æºç ä¸­ tabBarComponent æ˜¯æ€æ ·å¤„ç†çš„ï¼š createBottomTabNavigator æ˜¯åœ¨ react-navigation-tabs è¿™ä¸ªåŒ…ä¸­ï¼Œä½¿ç”¨çš„ tabbarComponent åœ¨ react-navigation-tabs/dist/views/BottomTabBar.js, éƒ¨åˆ†æºç å¦‚ä¸‹å›¾ï¼š

![source code](../assets/soucecode.png)

å¯ä»¥çœ‹åˆ°å†³å®šåœ¨ tabBarComponent æ¸²æŸ“å‡ ä¸ªæŒ‰é’®çš„å…³é”®å°±æ˜¯ props.navigation.state çš„ routes å’Œ index,è€Œä¸” props ä¸­ navigation å°±åªç”¨åˆ°äº†è¿™ä¸ªå±æ€§ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ navigation çš„å…¶ä»–åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘çš„æƒ³æ³•å°±æ˜¯å•ç‹¬å¼•å…¥è¿™ä¸ª BottomTabBar ç»„ä»¶ï¼Œç„¶åå†åŸºäºè¿™ä¸ªå°è£…è‡ªå·±çš„ BottomTabBarã€‚

```js
//tabbar.js
import { BottomTabBar } from "react-navigation-tabs";

const tabbarRoutes = {
  é¦–é¡µ: Home,
  å•†å“æ¨è: LoanMarket,
  æˆ‘çš„: MyInfo
};

const originalRoutes = [
  { key: "é¦–é¡µ", routeName: "é¦–é¡µ", params: undefined },
  { key: "å•†å“æ¨è", routeName: "å•†å“æ¨è", params: undefined },
  { key: "æˆ‘çš„", routeName: "æˆ‘çš„", params: undefined }
];

//è‡ªå®šä¹‰BottomTabBar
class CustomBottomTabBar extends PureComponent {
  state = {
    showMarket: false
  };

  componentDidMount = () => {
    // è¿™é‡Œç›‘å¬ä¸€ä¸ªäº‹ä»¶ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºå•†å“æ¨èé¡µé¢ï¼Œåˆ™å°†showMarketç½®ä¸ºtrue
    this.subscribe = DeviceEventEmitter.addListener("showMarket", () => {
      this.setState({
        showMarket: true
      });
    });
  };

  componentWillUnmount = () => {
    this.subscribe && this.subscribe.remove();
  };

  // è¿™é‡Œå¯¹navigationè¿›è¡Œå¤„ç†ï¼Œæ³¨æ„è¿™é‡Œä¸èƒ½ç›´æ¥ä¿®æ”¹props.navigation,ä¼šæŠ¥é”™ï¼Œ
  //æ‰€ä»¥åªéœ€è¦ä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„navigationï¼Œè€ŒBottomTabBaråªä¼šç”¨åˆ°navigation.stateä¸­routeså’Œindex,
  //æ‰€ä»¥å°±æ„é€ è¿™ä¹ˆä¸€ä¸ªè™šå‡çš„navigationå°±å¯ä»¥äº†
  dealNavigation = () => {
    const { routes, index } = this.props.navigation.state;
    // æ ¹æ®æ˜¯å¦éœ€è¦æ˜¾ç¤ºå•†å“æ¨èèœå•æ¥å†³å®šstateä¸­çš„routes
    let finalRoutes = originalRoutes;
    if (!this.state.showMarket) {
      finalRoutes = originalRoutes.filter(route => route.key !== "å•†å“æ¨è");
    }
    const currentRoute = routes[index];
    return {
      state: {
        index: finalRoutes.findIndex(route => currentRoute.key === route.key), //ä¿®æ­£index
        routes: finalRoutes
      }
    };
  };

  render() {
    const { navigation, ...restProps } = this.props;
    const myNavigation = this.dealNavigation();
    return <BottomTabBar {...restProps} navigation={myNavigation} />;
  }
}

const MyTabRouter = createBottomTabNavigator(tabbarRoutes, {
  navigationOptions: tabRouterConfig.navigationOptions,
  tabBarOptions: tabRouterConfig.tabBarOptions,
  tabBarComponent: CustomBottomBar
});

export default class Tabs extends PureComponent {
  //è¿™é‡Œå¿…é¡»æœ‰è¿™ä¸ªé™æ€å±æ€§ï¼Œè¡¨ç¤ºå°†è¿™ä¸ªé¡µé¢è§†ä¸ºä¸€ä¸ªnavigatorï¼Œè¿™æ ·æ‰èƒ½å’ŒAppStackå…±ç”¨ä¸€å¥—å¯¼èˆªç³»ç»Ÿ
  static router = MyTabRouter.router;
  render() {
    return <MyTabRouter navigation={this.props.navigation} />;
  }
}
```

è¿™ç§æ–¹æ¡ˆæ˜¯æœ€å¥½çš„æ–¹æ¡ˆï¼Œåœ¨ä¸€å¼€å§‹å°±é™æ€å®šä¹‰æ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„è·¯ç”±ï¼Œç„¶ååœ¨åº•éƒ¨èœå•è¿™é‡Œåšæ–‡ç« ï¼Œæ ¹æ®ç”¨æˆ·çš„æƒé™æ¥å†³å®šéšè—æˆ–æ˜¾ç¤ºæŸä¸ªè·¯ç”±å…¥å£ï¼Œè€Œä¸”æ•´ä¸ª App ä¹Ÿéƒ½ç”¨åŒä¸€ä¸ª navigation è¿›è¡Œå¯¼èˆªï¼Œå°±æ˜¯æƒ³å»å“ªå„¿å°±å»å“ªå„¿ï¼Œcool
